---
title: "Brain & Mind Centre - Introduction into R Workshop"
subtitle: "Day 1"
author: "Gordon McDonald, Madhura Killedar, Nicholas Ho and Darya Vanichkina"
output:
  html_document:
    toc: true
    toc_float:
      collapsed: false
    theme: lumen
    hightlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      cache = FALSE)
```

[Back to homepage](https://n-ho.github.io/bmc_r_workshop_2018/)

## Introduction

Welcome to the home page for the Brain & Mind Centre Introduction into R workshop. It is a three day course covering six seperate topics that occur frequently to anyone doing pragmatic data analysis. The content is structured in such a way that the material in a section is independent to the other sections, so if you can only make part of the course this won't impact your learning.

These courses are designed to be informal and free flowing, so whilst there is some material we have prepared, if you have a question then at anytime please let us know and we will be more than happy to assist. If there is anything that we can't answer on the day, we will note it down and make sure that we get back to you with a thorough solution.

## About R

### The R Programming Language

[R](https://www.r-project.org/) is an open source programming language and software environment for statistical computing and graphics that is supported by the R Foundation for Statistical Computing. Today, it is one of the most popular languages, being used all across the world in a wide variety of domains and fields.

### RStudio

[RStudio](https://www.rstudio.com/) is an integrated development environment (IDE) for R. It includes a console, syntax-highlighting editor that supports direct code execution, as well as tools for plotting, history, debugging and workspace management.

![Example RStudio Screenshot](RStudioSS.png)

### Installation & Setup

First let's set up the Rstudio panes so that everyone is on the same page.

*Tools* -> *Global Options* -> *Pane Layout*

**Top left:** Console

**Top right:** Source 

**Bottom left:** Files, Plots, etc

**Bottom right:** Environment, History, etc


### Starting a new R-project

We'll start a new R-project so we can save our progress and relaunch at anytime. 

*File* -> *New Project* -> *New Directory* -> *Empty Project*

We'll call our project "introduction_into_r" and save it in, say, "Documents" folder (or "My Documents" for Windows users)

Note that in "Files", you have a new Rproj file.


### Install prerequisites

Below is a script that installs packages that you will need for the next three days and also sets some options which will make the course run smoothly. We will explain what the script does as we get further into the material, but for the meantime we would ask that you copy the script and run it in your environment.

```{r installation, eval=FALSE, message=FALSE}
LoadPackages <- function(x){ for( i in x ){ if( ! require( i , character.only = TRUE ) ){
  install.packages( i , dependencies = TRUE , repos = "http://cran.us.r-project.org")
  require( i , character.only = TRUE )}}}

#  Then try/install packages...
LoadPackages(c("tidyverse",
               "xlsx",
               "ggplot2",
               "foreign",
               "dplyr"))

options(scipen = 999)
set.seed(2018)
```


### R variable and data types

First, we introduce the common variable types and data types that you'll be working with in R. Commonly, errors involve using the wrong variable or data type 

**Variable type** | **Type** | **Example**
------------|---------------|---------------------------------
integer | Whole numbers | 1, 100, -9
numeric | Decimals | 0.1, -0.09, 234.567
character | Text | "A", "hello", "welcome"
logical | Booleans | TRUE or FALSE
factor | Categorical | "green", "blue", "red", "purple"

**Data type** | **Type**
---------------|------------------------------------------------
vector | 1D collection of variables of the same type 
matrix | 2D collection of variables of the same type
data.frame | 2D collection of variables of multiple types


![R variable and data types](Rvariablesdata.jpg)

## Getting Started


### Working directory
We've created this project in a "working directory". To check where this is, use:
```{r}
getwd()
```


### Calculating things in R

Standard math functions work in R:
```{r}
2+3

1/1000

sqrt(2)
```

We can store values in variables. Variables are a way to both store data and to label data.
```{r}
myvariable <- 3
myvariable

myvariable = 3
myvariable

3 -> myvariable
myvariable


myvariable^2
```


### Vectors
We can create 1D data structures called "vectors".
```{r}
1:10

2*(1:10)

seq(0, 10, 2)
```


We can store vectors and perform operations on them.
```{r}
myvector <- 1:10
myvector

2^myvector

b <- c(3,4,5)
b^2

disorders <- c("autism","ocd ","depression")
disorders
```

### Data frames

A lot of the time in R, we are working with tables of data, know as "data frames". 

Commonly, 

**rows** may represent instances e.g. *data points*, *patients*, *events*, *samples*, etc. while 

**columns** will represent different types of data associated with each data point or instance e.g. *Name*, *ID*, *location*, *time*, *value*...

Here is an example data frame

```{r}
bmc.data <- data.frame(fname = c("Alice", "Bob", "Carol", "David"),
                       gender = as.factor(c("Female", "Male", "Female", "Male")),
                       disorder = c("autism", "anxiety", "autism", "depression"),
                       age = c(20, 45, 15, 12),
                       biomarker1 = c(5, 4, 1, 10),
                       clinicalstage = c("1b", "1a", "1a", "2"),
                       stringsAsFactors = FALSE)
```

### Viewing The Data
Use the function `View()` to visually inspect the data in a new RStudio pane
```{r eval=FALSE}
View(bmc.data)
```

How many rows and columns do we have?
```{r}
nrow(bmc.data)
ncol(bmc.data)
dim(bmc.data)
```


### Accessing Subsets
Return the first N rows of your data frame
```{r}
head(bmc.data)
```

The default for the `head()` function is to show the first 6 rows. How do we know this? Type `?` infront of the function name in your console
```{r}
?head
```

Return the first 3 rows of your data frame
```{r}
head(bmc.data, n = 3)
head(bmc.data, 3)
bmc.data[1:3, ]
bmc.data[c(1, 2, 3), ]
bmc.data[c(TRUE, TRUE, TRUE, FALSE), ]
```


Return the last 2 rows in a data set
```{r}
tail(bmc.data, 2)
```


Return the "age" column in the data set
```{r}
bmc.data$age
bmc.data[, 4]
bmc.data[, "age"]
bmc.data[, c(F, F, F, T, F, F, F)] 
```

Return only the first 3 rows and columns 2 and 5 of the data set
```{r}
bmc.data[1:3, c(2,5)]
```

Return the columns named "fname" and "biomarker1"
```{r}
bmc.data[,c("fname", "biomarker1")]
```


### Filtering the data

Return only the rows (patients) who are Female
```{r}
bmc.data[bmc.data$gender == "Female", ]
```

What exactly happened here? We made a vector of `TRUE/FALSE` statements, for each row in which this condition is true and then we subset rows in which the index is true
```{r}
females <- bmc.data$gender == "Female"
females

bmc.data[females, ]
```

Another way to subset the patients is with the `which()` function
```{r}
females <- which(bmc.data$gender == "Female")
females

bmc.data[females, ]
bmc.data[which(bmc.data$gender == "Female"), ]
```


What if we want all patients older than 16 years of age?
```{r}
bmc.data[bmc.data$age > 16, ]
```


### Quiz
1. Return those patients whose clinical stage is "1a"

2. Return those patients whose biomarker1 value is less than 6

3. Return just the first name of all patients older than 16 years of age




## More Realistic Data

The dataset that we will be using today is taken from University of California, Irvine's Machine Learning Repository. We will be examining the [Autism Screening Adult Data Set](https://archive.ics.uci.edu/ml/datasets/Autism+Screening+Adult). This is data collected by Dr Fadi Fayez Thabtah at NMIT via the mobile app ASD Tests.

Click [here](https://raw.githubusercontent.com/n-ho/bmc_r_workshop_2018/master/_episodes/autism_data.csv) to open the data on your browser. Then, right-click and Save As "autism_data" in the "comma-separated values" or "csv" format into your working directory.

Variable | Definition
-----------------|------------------------------------------------
id | The participant's ID number
AX_Score | Score based on the Autism Spectrum Quotient (AQ) 10 item screening tool [AQ-10](http://docs.autismresearchcentre.com/tests/AQ10.pdf)
age | Age in years
gender | Male or Female
ethnicity | Ethnicities in text form
jaundice | Whether or not the participant was born with jaundice?
autism | Whether or not anyone in tbe immediate family has been diagnosed with autism?
country_of_res| Countries in text format
used_app_before | Whether the participant has used a screening app
result | Score from the AQ-10 screening tool
age_desc | Age as categorical
relation | Relation of person who completed the test
Class/ASD | Participant classification


### Reading in Data

The first thing to do before we can begin an analysis is loading some data. To do this we can use the below command.

```{r read_data_1}
autism.data <- read.csv(file = "autism_data.csv",
                        header = TRUE,
                        sep = ",",
                        na.strings = "?")
```

Before going any further, let's break down what this command does specifically.

1. It reads the file, which could be 
- a file path e.g. `"~/Documents/MyFolder/datafile.csv"`
- a url like we have here e.g. `"http://www.website.com/subdomain/datafile.csv"`
2. It specifies that the first row in the csv file contains "header" information i.e. column names
3. It specifies that neighbouring columns are separated by a comma "," 
4. It specifies that this CSV file uses "?" as the text for missing data

How would we find this out if we didn't know already? Look at the help file:
```{r eval=FALSE}
?read.csv
```

Comma Separated Value (.csv) files are usually the standard, simplest format which is compatible with all sort of different software, e.g. R, python, Excel, MATLAB, ...

But if we needed to read in a different format of data, there's usually a function or a library for doing just that,

e.g.
in base R:

- `read.csv()`
- `read.table()`

In the package "xlsx":

- `read.xlsx()`

In the package "haven":

- `read_spss()` for SPSS files


### Viewing The Data
Remember, we use the function `View()` to visually inspect at the data
```{r, eval = FALSE}
View(autism.data)
```


What variables are included in this dataset?
```{r}
colnames(autism.data)
```


A handy way to inspect your data is to summarise it. To do so, use the `summary()` function
```{r}
summary(autism.data)
```


### Changing The Column Names
We've a typo in the country of residence column. Let's correct this.
```{r}
colnames(autism.data)

which(colnames(autism.data) == "contry_of_res")

colnames(autism.data)[17] <- "country"
```

Afterwards, view the data again to check the column names have been changed 
```{r eval=FALSE}
View(autism.data)
```

### Add a new column
Let's create a better participant ID than just 1,2,3,...

The first function we will need is `paste()`. This function concatenates strings. For example;
```{r}
paste("hel", "lo")
```


This leaves an unwanted gap, hence we'll use the `sep` parameter
```{r}
paste("hel", "lo", sep = "")
```

Now let's add the letter "P" to the front of the IDS. Then, we'll add this as a new column
```{r}
new_ids <- paste( "P" , autism.data$id, sep = "")

autism.data$pids <- new_ids 
```

Afterwards, view the data again to check the new "pids" column.
```{r eval=FALSE}
View(autism.data)
```



### Accessing Subsets
Let's look at all the records for those with a family history of autism:
```{r}
family.autism.data <- autism.data[autism.data$autism == "yes",]
```

What is the average AQ-10 score for those with a familial history of autism?
```{r}
mean(family.autism.data$result)
```

What about for those with no familial history of autism?
```{r}
no.family.autism.data <- autism.data[autism.data$autism == "no",]
mean(no.family.autism.data$result)
```

Who is the oldest person in the dataset and what is their age?
```{r}
max(autism.data$age)

# ignore missing data
max(autism.data$age, na.rm = TRUE)
which.max(autism.data$age)
```

Someone is apparently 383 years old! Let's remove this person
```{r}
autism.data <- autism.data[-which.max(autism.data$age), ]
```


```{r}
brisbane.only$Month.Year[which.max(brisbane.only$Player.Money.Lost)]
```


What if we want the rows from brisbane which happen in 2010?
```{r}
row.indicies<-(brisbane.only$Date>="2010-01-01 AEST" &
                 brisbane.only$Date<="2010-12-31 AEST")

(brisbane.2010.data<-brisbane.only[row.indicies,])

```

On the last line we used a shortcut; if you want to assign a variable with `<-` but also print it, you can put the whole expression in parentheses.

### Summarising The Data
Use the summary function to return a quick summary

```{r}
summary(autism.data)
summary(brisbane.only)
summary(brisbane.2010.data)
```

Use the summary function to return a quick summary of only the money column

```{r}
summary(brisbane.2010.data$Player.Money.Lost)
```

Get a random selection of data and look at which Local government areas are included

```{r}
random.fifty.rows<-dplyr::sample_n(autism.data,50)

#look at each row's Local Government Area (LGA)
random.fifty.rows$Local.Govt.Area

#look at the unique local government areas (duplicates removed)
unique(random.fifty.rows$Local.Govt.Area)

#look at how many rows there are for each LGA
table(random.fifty.rows$Local.Govt.Area)
```

Challenge: find which Local government area had the lowest non-zero amount of money lost in a month.

## Data Types

There are several different types of data you can use in R, and you can even make your own new *types* (but we won't touch on that today). Now we will examine a few common ones in a little more detail.

### Strings

Character strings are known as "character" in R:

```{r}
autism.data$Local.Govt.Area[3]

class(autism.data$Local.Govt.Area)
```

### Numbers

Numbers have different classes, they can be integer:

```{r}
autism.data$Operational.EGMs[36]

class(autism.data$Operational.EGMs)
```

They can be numeric:

```{r}
autism.data$Player.Money.Lost[84]

class(autism.data$Player.Money.Lost)

class(0.1)

class(pi)
```
They can be complex:

```{r}
class(1i+3)
```

They can be double:

```{r}
x<-as.double(3.345678987654323456789)
```

They can have rounding errors
```{r}
x-(x-0.0000000000001)
```

### Logical (True/False)

```{r}
class(TRUE)
class(1==1)
```

### Factor

A factor is a string label on top of an integer index

```{r}
as.factor("I am a label")
```

This makes most sense in the context of a survey response, e.g. 1=Good, 2, 3=Average, 4, 5=Bad; or something like that. For example in the simple data we had at the beginning, gender is a factor.

```{r}
class(bmc.data$gender)
bmc.data$gender
as.numeric(bmc.data$gender)
table(bmc.data$gender)
```


### Vectors and Lists
Vectors are all of the same class


```{r}
#a vector
c("a","b","c")

#another vector
c(1,4,7)
```

If you try to put different classes of things into a vector it will try to convert them to the same class.

```{r}
#this will be converted to a vector of character strings
(what.am.I<-c("a",2,"c",FALSE,c(1,2,3)))
class(what.am.I)
```

Lists can contain different classes of things in each element, possibly of different lengths
```{r}
#a list
list("a",2,"c",FALSE,c(1,2,3))
```

### Data frames

Data frames are really a list of vectors of equal length, and they function like a table of data. We made one right at the beginning:

```{r eval=FALSE}
bmc.data<-data.frame(first.name=c("Alice",
                                     "Bob",
                                     "Cathy",
                                     "Daniel"),
                        gender=as.factor(c("Female",
                                           "Male",
                                           "Female",
                                           "Male")),
                        favourite.number=c(4,23,pi,exp(1)),
                        favourite.letter=c("a","c","x","q"),
                        favourite.weekday=c("Monday","Thursday","Sunday","Friday"),
                        stringsAsFactors = FALSE)
```

- We made a column called "first.name", a vector of character strings (favourite.letter and favourite.weekday are also character strings)

- We made a column called "gender", a vector of factors

- We made a column called "favourite.number", a vector of class numeric

- Lastly we told it to not convert all the character string colums into factors (which is something it does by default) by adding the optional argument `stringsAsFactors = FALSE` to the `data.frame()` function.

### Adding records
Add a new row to the data set using the rbind() function:

```{r eval=FALSE}
new.person <- data.frame(first.name="Evelyn",
                        gender="Female",
                        favourite.number=12,
                        favourite.letter="z",
                        favourite.weekday="Monday",
                        stringsAsFactors = FALSE)

bmc.data<-rbind(bmc.data,new.person)

```


## Writing Data
Use the write.table() function to make the datafile a text file

```{r}
write.table(x = bmc.data,
            file = "simpleData.txt",
            row.names = FALSE,
            col.names = TRUE,
            sep = ",")
```

Use the write.csv() function to make the datafile a csv (comma separated values) file

```{r}
write.csv(x = bmc.data,
          file = "simpleData.csv",
          row.names = FALSE)
```

          
Use the write.xlsx